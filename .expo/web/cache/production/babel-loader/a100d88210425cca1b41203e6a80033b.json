{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";function _createForOfIteratorHelperLoose(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}it=o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]();return it.next.bind(it);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import*as badgin from'badgin';import uuidv4 from'uuid/v4';import{guardPermission,getExponentPushTokenAsync as _getExponentPushTokenAsync,getDevicePushTokenAsync as _getDevicePushTokenAsync}from\"./ExponentNotificationsHelper.web\";import\"./ExponentNotifications.fx.web\";var currentBadgeNumber=0;function transformLocalNotification(notification,tag){var _notification$web=notification.web,web=_notification$web===void 0?{}:_notification$web,abstractNotification=_objectWithoutProperties(notification,[\"web\"]);tag=web.tag||tag;var nativeNotification=_objectSpread(_objectSpread(_objectSpread({},abstractNotification),{},{tag:tag},web),{},{_isLocal:true});return[nativeNotification.title,nativeNotification];}function getRegistrationAsync(){var registration;return _regeneratorRuntime.async(function getRegistrationAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:guardPermission();_context.next=3;return _regeneratorRuntime.awrap(navigator.serviceWorker.getRegistration());case 3:registration=_context.sent;if(registration){_context.next=6;break;}throw new Error('Failed to get notification registration!');case 6:return _context.abrupt(\"return\",registration);case 7:case\"end\":return _context.stop();}}},null,null,null,Promise);}function getNotificationsAsync(tag){var registration,notifications;return _regeneratorRuntime.async(function getNotificationsAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(getRegistrationAsync());case 2:registration=_context2.sent;_context2.next=5;return _regeneratorRuntime.awrap(registration.getNotifications(tag?{tag:tag}:undefined));case 5:notifications=_context2.sent;return _context2.abrupt(\"return\",notifications);case 7:case\"end\":return _context2.stop();}}},null,null,null,Promise);}export default{presentLocalNotification:function presentLocalNotification(notification){var registration,tag;return _regeneratorRuntime.async(function presentLocalNotification$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(getRegistrationAsync());case 2:registration=_context3.sent;tag=uuidv4();registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));return _context3.abrupt(\"return\",tag);case 6:case\"end\":return _context3.stop();}}},null,null,null,Promise);},scheduleLocalNotification:function scheduleLocalNotification(notification){var options,registration,tag,intervalMs,_args4=arguments;return _regeneratorRuntime.async(function scheduleLocalNotification$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:options=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};if(!options.intervalMs){_context4.next=10;break;}_context4.next=4;return _regeneratorRuntime.awrap(getRegistrationAsync());case 4:registration=_context4.sent;tag=uuidv4();setTimeout(function(){registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));},options.intervalMs);return _context4.abrupt(\"return\",tag);case 10:if(!options.time){_context4.next=15;break;}intervalMs=options.time-Date.now();if(!(intervalMs<0)){_context4.next=14;break;}throw new Error('Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.');case 14:return _context4.abrupt(\"return\",this.scheduleLocalNotification(notification,{intervalMs:intervalMs}));case 15:throw new Error(\"Expo.Notifications.scheduleLocalNotification() options \"+JSON.stringify(options,null,2)+\" are not supported yet.\");case 16:case\"end\":return _context4.stop();}}},null,this,null,Promise);},dismissNotification:function dismissNotification(notificationId){var notifications,_iterator,_step,notification;return _regeneratorRuntime.async(function dismissNotification$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(getNotificationsAsync(notificationId));case 2:notifications=_context5.sent;for(_iterator=_createForOfIteratorHelperLoose(notifications);!(_step=_iterator()).done;){notification=_step.value;notification.close();}case 4:case\"end\":return _context5.stop();}}},null,null,null,Promise);},dismissAllNotifications:function dismissAllNotifications(){return _regeneratorRuntime.async(function dismissAllNotifications$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:this.dismissNotification();case 1:case\"end\":return _context6.stop();}}},null,this,null,Promise);},cancelScheduledNotificationAsync:function cancelScheduledNotificationAsync(notificationId){return _regeneratorRuntime.async(function cancelScheduledNotificationAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.dismissNotification(notificationId);case 1:case\"end\":return _context7.stop();}}},null,this,null,Promise);},cancelAllScheduledNotificationsAsync:function cancelAllScheduledNotificationsAsync(){return _regeneratorRuntime.async(function cancelAllScheduledNotificationsAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:this.dismissNotification();case 1:case\"end\":return _context8.stop();}}},null,this,null,Promise);},getExponentPushTokenAsync:function getExponentPushTokenAsync(){return _regeneratorRuntime.async(function getExponentPushTokenAsync$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return _regeneratorRuntime.awrap(_getExponentPushTokenAsync());case 2:return _context9.abrupt(\"return\",_context9.sent);case 3:case\"end\":return _context9.stop();}}},null,null,null,Promise);},getDevicePushTokenAsync:function getDevicePushTokenAsync(){return _regeneratorRuntime.async(function getDevicePushTokenAsync$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return _regeneratorRuntime.awrap(_getDevicePushTokenAsync());case 2:return _context10.abrupt(\"return\",_context10.sent);case 3:case\"end\":return _context10.stop();}}},null,null,null,Promise);},getBadgeNumberAsync:function getBadgeNumberAsync(){return _regeneratorRuntime.async(function getBadgeNumberAsync$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:return _context11.abrupt(\"return\",currentBadgeNumber);case 1:case\"end\":return _context11.stop();}}},null,null,null,Promise);},setBadgeNumberAsync:function setBadgeNumberAsync(badgeNumber){return _regeneratorRuntime.async(function setBadgeNumberAsync$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:currentBadgeNumber=badgeNumber;badgin.set(badgeNumber);case 2:case\"end\":return _context12.stop();}}},null,null,null,Promise);}};","map":{"version":3,"sources":["../../src/Notifications/ExponentNotifications.web.ts"],"names":[],"mappings":"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","sourcesContent":["import * as badgin from 'badgin';\nimport uuidv4 from 'uuid/v4';\n\nimport {\n  guardPermission,\n  getExponentPushTokenAsync,\n  getDevicePushTokenAsync,\n} from './ExponentNotificationsHelper.web';\nimport { LocalNotification, LocalNotificationId } from './Notifications.types';\n\n// Register `message`'s event listener (side-effect)\nimport './ExponentNotifications.fx.web';\n\nlet currentBadgeNumber = 0;\n\nfunction transformLocalNotification(\n  notification: LocalNotification,\n  tag: string\n): [string, NotificationOptions] {\n  const { web = {}, ...abstractNotification } = notification;\n  tag = web.tag || tag;\n  const nativeNotification = {\n    ...abstractNotification,\n    tag,\n    ...web,\n    // Show that this notification is a local notification\n    _isLocal: true,\n  };\n  return [nativeNotification.title, nativeNotification];\n}\n\nasync function getRegistrationAsync(): Promise<ServiceWorkerRegistration> {\n  guardPermission();\n  const registration = await navigator.serviceWorker.getRegistration();\n  if (!registration) {\n    throw new Error('Failed to get notification registration!');\n  }\n  return registration;\n}\n\nasync function getNotificationsAsync(tag?: string): Promise<Notification[]> {\n  const registration = await getRegistrationAsync();\n  const notifications = await registration.getNotifications(tag ? { tag } : undefined);\n  return notifications;\n}\n\nexport default {\n  async presentLocalNotification(notification: LocalNotification): Promise<LocalNotificationId> {\n    const registration = await getRegistrationAsync();\n    const tag = uuidv4();\n    registration.showNotification(...transformLocalNotification(notification, tag));\n    return tag;\n  },\n  async scheduleLocalNotification(\n    notification: any,\n    options: {\n      time?: Date | number;\n      repeat?: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year';\n      intervalMs?: number;\n    } = {}\n  ): Promise<string> {\n    if (options.intervalMs) {\n      const registration = await getRegistrationAsync();\n      const tag = uuidv4();\n      setTimeout(() => {\n        registration.showNotification(...transformLocalNotification(notification, tag));\n      }, options.intervalMs);\n      return tag;\n    } else if (options.time) {\n      const intervalMs = (options.time as number) - Date.now();\n      if (intervalMs < 0) {\n        throw new Error(\n          'Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.'\n        );\n      }\n      return this.scheduleLocalNotification(notification, {\n        intervalMs,\n      });\n    }\n    throw new Error(\n      `Expo.Notifications.scheduleLocalNotification() options ${JSON.stringify(\n        options,\n        null,\n        2\n      )} are not supported yet.`\n    );\n  },\n\n  async dismissNotification(notificationId?: string): Promise<void> {\n    const notifications = await getNotificationsAsync(notificationId);\n    for (const notification of notifications) {\n      notification.close();\n    }\n  },\n  async dismissAllNotifications(): Promise<void> {\n    this.dismissNotification();\n  },\n  async cancelScheduledNotificationAsync(notificationId: string): Promise<void> {\n    this.dismissNotification(notificationId);\n  },\n  async cancelAllScheduledNotificationsAsync(): Promise<void> {\n    this.dismissNotification();\n  },\n\n  async getExponentPushTokenAsync(): Promise<string> {\n    return await getExponentPushTokenAsync();\n  },\n\n  async getDevicePushTokenAsync(): Promise<{ type: string; data: object }> {\n    return await getDevicePushTokenAsync();\n  },\n\n  async getBadgeNumberAsync(): Promise<number> {\n    return currentBadgeNumber;\n  },\n\n  async setBadgeNumberAsync(badgeNumber: number): Promise<void> {\n    currentBadgeNumber = badgeNumber;\n    badgin.set(badgeNumber);\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}